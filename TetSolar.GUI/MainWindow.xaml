<Window x:Class="TetSolar.GUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:vm="clr-namespace:TetSolar.GUI.ViewModels"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=vm:MainViewModel}"

        Title="TET SOLAR" Height="800" Width="1200"
        Background="#0F1115" Foreground="#E6E6E6"
        PreviewKeyDown="OnWindowPreviewKeyDown"
        KeyDown="OnWindowKeyDown"
        PreviewMouseDown="OnWindowPreviewMouseDown"
        Loaded="OnWindowLoaded">

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="10,6"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Background" Value="#171A20"/>
            <Setter Property="BorderBrush" Value="#2A2F3A"/>
            <Setter Property="Foreground" Value="#E6E6E6"/>
        </Style>
        <Style TargetType="DataGrid">
            <Setter Property="Margin" Value="6"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="Background" Value="#12151B"/>
            <Setter Property="RowBackground" Value="#12151B"/>
            <Setter Property="AlternatingRowBackground" Value="#161A22"/>
            <Setter Property="Foreground" Value="#E6E6E6"/>
            <Setter Property="BorderBrush" Value="#2A2F3A"/>
        </Style>
    </Window.Resources>

    <DockPanel>

        <!-- Top bar -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Background="#12151B" Margin="8">
            <Button Content="Play/Stop" Click="OnPlayStop"/>
            <Button x:Name="RecordBtn" Content="Record" Click="OnRecord" Margin="4" />
            <Button Content="Load MIDI" Click="OnLoadMidi"/>
            <Button Content="Quit" Click="OnQuit"/>

            <!-- Working Dir -->
            <TextBlock Text="   Working Dir:" VerticalAlignment="Center" Margin="10,0,4,0"/>
            <TextBox x:Name="WorkingDirBox" Width="320" IsReadOnly="True" />
            <Button Content="Browse…" Click="OnBrowseWorkingDir"/>

            <!-- BPM -->
            <TextBlock Text="   BPM:" VerticalAlignment="Center" Margin="10,0,4,0"/>
            <TextBox x:Name="BpmBox" Width="70" Text="60.0" PreviewTextInput="OnBpmPreviewTextInput" LostFocus="OnBpmLostFocus"/>
        </StackPanel>

        <!-- Status bar -->
        <StatusBar DockPanel.Dock="Bottom" Background="#0F1115" Foreground="#A8B0BF">
            <StatusBarItem Content="{Binding StatusText}"/>
            <Separator/>
            <StatusBarItem Content="{Binding MidiOutLabel}"/>
            <Separator/>
            <StatusBarItem Content="{Binding PbLabel}"/>
            <Separator/>
            <StatusBarItem Content="{Binding TransposeLabel}"/>
        </StatusBar>




        <!-- Main split: IW left, CIP right -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Live Info Window -->
            <!-- Live View (always on): 3 columns -->
            <Border Grid.Column="0" Margin="8" Padding="8" CornerRadius="8"
        Background="#12151B" BorderBrush="#2A2F3A" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header row -->
                    <DockPanel Grid.Row="0" Margin="0,0,0,6">
                        <TextBlock Text="Live View" FontWeight="Bold"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="A−" Margin="8,0,0,0" Click="OnZoomMinus"/>
                            <Button Content="A+" Margin="4,0,0,0" Click="OnZoomPlus"/>
                        </StackPanel>
                    </DockPanel>

                    <!-- 3-column live area -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <!-- 1) Shortcode (static) -->
                            <ColumnDefinition Width="2*"/>
                            <!-- 2) Names (scroll) -->
                            <ColumnDefinition Width="8*"/>
                            <!-- 3) Field (pipes) -->
                        </Grid.ColumnDefinitions>

                        <!-- COL 1: Shortcode → pcs (STATIC, not scrolling) -->
                        <TextBox x:Name="ShortcodeBox"
                        Focusable="False"
                        Grid.Column="0"
                        FontFamily="Consolas"
                        FontSize="12"
                        IsReadOnly="True"
                        VerticalScrollBarVisibility="Auto"
                        Background="#0F1115"
                        Foreground="#E6E6E6"
                        AcceptsReturn="True"
                        AcceptsTab="True"
                        Padding="6"
                        BorderThickness="0"
                        TextWrapping="Wrap"
                        HorizontalScrollBarVisibility="Disabled"
                        IsReadOnlyCaretVisible="True"        >   
                          
                        </TextBox>
                    

                        <!-- COL 2: Names (SCROLLS once per chord change) -->
                        <TextBox x:Name="NamesBox"
                           Grid.Column="1"
                           Focusable="False"
                           FontFamily="Consolas"
                           FontSize="11"
                           Background="#0F1115"
                           Foreground="#E6E6E6"
                           AcceptsReturn="True"
                           IsReadOnly="True"
                           VerticalScrollBarVisibility="Hidden"
                           TextWrapping="NoWrap"
                           Padding="6"
           />

                        <!-- COL 3: Pipe field (248-scale), autoscroll, tiny font -->
                        <TextBox x:Name="LiveBox"
                           Grid.Column="2"
                           Focusable="False"
                           FontFamily="Consolas"
                           FontSize="10"
                           Background="#0F1115"
                           Foreground="#E6E6E6"
                           AcceptsReturn="True"
                           IsReadOnly="True"
                           VerticalScrollBarVisibility="Auto"
                           TextWrapping="NoWrap"
                           Padding="6"
                           />
                    </Grid>

                    
                    
                </Grid>
            </Border>



            <!-- Chord Input Panel (CIP) -->
            <Border Grid.Column="1" Margin="8" Padding="8" CornerRadius="8"
                    Background="#12151B" BorderBrush="#2A2F3A" BorderThickness="1">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
                        <Button Content="New" Click="OnNewRow"/>
                        <Button Content="Duplicate" Click="OnDuplicateRow"/>
                        <Button Content="Delete" Click="OnDeleteRow"/>
                        <Button Content="Apply" Click="OnApplyCip"/>
                        <Button x:Name="KeyLabelToggleBtn" Content="MIDI" Click="OnToggleKeyLabels"
            ToolTip="Toggle left column labels: MIDI (C3..) ↔ 123 (typing keys)"/>

                    </StackPanel>

                    <!-- Bottom library controls -->
                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="0,6,0,0">
                        <Button Content="Load"   Click="OnLibraryLoad"   Margin="4,0"/>
                        <Button Content="Append" Click="OnLibraryAppend" Margin="4,0"/>
                        <Button Content="Save"   Click="OnLibrarySave"   Margin="4,0"/>
                        <TextBlock Text="   Library:" VerticalAlignment="Center" Margin="10,0,4,0"/>
                        <TextBox Width="220" Text="{Binding LibraryName, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>


                    <!-- ******************* DATA GRID **********************-->
                    <DataGrid Name="LibraryGrid"
          ItemsSource="{Binding LibraryRows}"
          AutoGenerateColumns="False"
          CanUserAddRows="False"
          SelectionMode="Extended"
          SelectionUnit="FullRow"
         
                              >
                        <DataGrid.Columns>

                            <!-- KEY -->
                            <DataGridTextColumn Header="Key" Binding="{Binding TriggerLabel}" Width="80" IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Focusable" Value="False"/>
                                        <Setter Property="IsHitTestVisible" Value="False"/>
                                        <Setter Property="Opacity" Value="0.85"/>
                                        <Setter Property="Margin" Value="6,0,6,0"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <!-- NAME-->
                            <DataGridTextColumn Header="Name"  Binding="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="*">
                                <DataGridTextColumn.EditingElementStyle>
                                    <Style TargetType="TextBox">
                                        <Setter Property="AcceptsReturn" Value="False"/>
                                    </Style>
                                </DataGridTextColumn.EditingElementStyle>
                            </DataGridTextColumn>
                            
                            <!-- CODE/PCs-->
                            <DataGridTextColumn Header="Code / PCs"  Binding="{Binding Code, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" Width="2*">
                                <DataGridTextColumn.EditingElementStyle>
                                    <Style TargetType="TextBox">
                                        <Setter Property="AcceptsReturn" Value="False"/>
                                    </Style>
                                </DataGridTextColumn.EditingElementStyle>
                            </DataGridTextColumn>

                            


                        </DataGrid.Columns>
                    </DataGrid>



                </DockPanel>
            </Border>
        </Grid>
    </DockPanel>
</Window>
